<html>

<canvas id="gameCanvas" width="800" height="600"></canvas>

<script>

var c;
var ctx;
var fps = 30;

//player ship variables
var spaceShipPosX = 400;
var spaceShipPosY = 500;
var spaceshipPic = document.createElement("img");
var spaceshipPicLoaded = false;
const PLAYER_SHIP_WIDTH = 60; //current width of pixel art
const PLAYER_SHIP_HEIGHT = 80; //current height of pixel art 
var speedBuffer = false;

var playerScore = 0;
var displayWinScreen = false;
var gameOn = true;
const WIN_SCORE = 1;
var displayGameOverScreen = false;

const KEY_LEFT_ARROW = 37;
const KEY_UP_ARROW = 38;
const KEY_RIGHT_ARROW = 39;
const KEY_DOWN_ARROW = 40;
const KEY_BACKSPACE = 32;
const KEY_Q = 81;

var shotActive = false;
var shotY;
var shotY;
const PLAYER_SHOT_SPEED = 10;

//alien variables
var alienPosX = 100;
var alienPosY = 100;
var alienSpeedX = 4;
const ALINE_WIDTH = 100;
const ALIEN_HEIGHT = 30;
var alienDestroyed = false;
var respawnTimer = 0;
var alienColor = 'green';
var alienShotActive = false;
var alienShotX;
var alienShotY;
const ALIEN_SHOT_SPEED = 10;


var screenBuffer = 20;


	setInterval (function() {
		drawEverything(),
		moveEverything()},
		1000/fps);

	document.addEventListener('keydown', keyPressed);
	document.addEventListener('keyup', keyReleased);
	
	window.onload = function () {
		drawEverything();
		moveEverything();	

		spaceshipPic.onload = function() {
			spaceshipPicLoaded = true;
		}
		spaceshipPic.src = "PlayerShip.png";
	}

function drawEverything() {
	//canvas
	c = document.getElementById ('gameCanvas');
	ctx = c.getContext ('2d');
	ctx.fillStyle = 'black';
	ctx.fillRect (0, 0, c.width, c.height);

	//player shot
	if(shotActive) {
		colorRect(shotX, shotY, 4, 10,'white');
	}

	//alien
	if(alienDestroyed == false) {
		colorRect(alienPosX, alienPosY, ALINE_WIDTH, ALIEN_HEIGHT, alienColor);
	}

	if(alienShotActive) {
		colorRect(alienShotX, alienShotY, 4, 10, 'white');
	}

	if(gameOn){
		//space ship
		if(spaceshipPicLoaded){
			ctx.drawImage(spaceshipPic, spaceShipPosX, spaceShipPosY);
		}

		//player score
		colorText("Score: " + playerScore, 700, 560, "15px arial", "white");

		respawnAlien();
	}

	//win screen
	if(gameOn == false) {
		if(displayWinScreen == true) {
			colorText("Player Wins", c.width/2 - 80, c.height/2, "30px arial", "white");
		}
		if(displayGameOverScreen == true){
			colorText("Game Over", c.width/2 - 80, c.height/2, "30px arial", "white");
		}
		colorText("New Game: [SPACE]", 330, 350, "15px arial", "white");
	}


}

function moveEverything() {
	moveShot();
	moveAlien();
	spaceshipAutoReverse();
}


function keyPressed(evt) {
	if(gameOn){
		//console.log("Key pressed: " + evt.keyCode);
		if (evt.keyCode == KEY_LEFT_ARROW) {
			if(spaceShipPosX >= 20) {
				spaceShipPosX -= 10;
			}
		}

		if (evt.keyCode == KEY_RIGHT_ARROW) {
			if(spaceShipPosX <= c.width - PLAYER_SHIP_WIDTH - 20) {
				spaceShipPosX += 10;
			}
		}

		if (evt.keyCode == KEY_UP_ARROW) {
			speedBuffer = false;
			if(spaceShipPosY >= 20){
				spaceShipPosY -= 5;
			}	
		}

		if (evt.keyCode == KEY_DOWN_ARROW) {
			if(spaceShipPosY <= 495){
				spaceShipPosY += 5;
			}
		}

		if(evt.keyCode == KEY_UP_ARROW && evt.keyCode == KEY_RIGHT_ARROW){
			speedBuffer = false;
			if(spaceShipPosY >= 20){
				spaceShipPosY -= 5;
			}
			if(spaceShipPosX <= c.width - PLAYER_SHIP_WIDTH - 20) {
				spaceShipPosX += 10;
			}

		}

		if(evt.keyCode == KEY_BACKSPACE) {
			playerReload();
		}

		if(evt.keyCode == KEY_Q) {
			console.log("alien shot");
			alienReload();
		}

	}

	if(gameOn == false) {
		if(evt.keyCode == KEY_BACKSPACE) {
			gameOn = true;
			playerScore = 0;
		}
	}


	evt.preventDefault(); // this is to prevent arrow keys from scrolling the page.
}

function keyReleased(evt) {
	//console.log("Key released: " + evt.keyCode);
	if(evt.keyCode == KEY_UP_ARROW) {
		speedBuffer = true;
	}
}

function spaceshipAutoReverse() {
	if(spaceShipPosY <= 495 && speedBuffer){
		spaceShipPosY += 1;
	}
}

function playerReload() {
	if(shotActive == false) {
		shotX = spaceShipPosX + 28;
		shotY = spaceShipPosY;
		shotActive = true;
	}
}

function alienReload(){
	if(alienShotActive == false) {
		alienShotX = alienPosX + ALINE_WIDTH/2;
		alienShotY = alienPosY + ALIEN_HEIGHT;
		alienShotActive = true;
	}
}

function moveShot() {
	if(shotActive) {
		shotY -= PLAYER_SHOT_SPEED;
		playerShotCheck();
	}
	if(alienShotActive){
		alienShotY += ALIEN_SHOT_SPEED;
		alienShotCheck();
	}
}

function playerShotCheck() {
	if(shotY <= alienPosY + ALIEN_HEIGHT && shotX >= alienPosX && shotX <= alienPosX + ALINE_WIDTH) {
		shotActive = false;
		console.log("alien destroyed");
		alienDestroyed = true;
		playerScoring();
	}
	if(shotY < 0) {
		shotActive = false;
	}
}

function alienShotCheck() {
	if(alienShotY >= spaceShipPosY && alienShotX >= spaceShipPosX && alienShotX <= spaceShipPosX + PLAYER_SHIP_WIDTH){
		alienShotActive = false;
		console.log("player destroyed");
		playerLose();
	}
	if(alienShotY >= c.height) {
		alienShotActive = false;
	}
}

function moveAlien() {
	alienPosX = alienPosX - alienSpeedX;
	
	if(alienPosX > c.width - ALINE_WIDTH - screenBuffer) {
		alienSpeedX = -alienSpeedX;
	}
	
	if(alienPosX < 0 + screenBuffer) {
		alienSpeedX = -alienSpeedX;
	}
}

function respawnAlien() {
	colorAlien();
	if(alienDestroyed == true){
		respawnTimer++;
		if(respawnTimer >= 60) {
			alienDestroyed = false;
			respawnTimer = 0;
		}
	}
}

function colorAlien() {
	if(playerScore == 0){
		alienColor = 'green';
	}
	if(playerScore == 1){
		alienColor = 'blue';
	}
	if(playerScore == 2){
		alienColor = 'red';

	}
}

function playerScoring() {
	playerScore ++;
	
	if(playerScore >= WIN_SCORE){
		displayWinScreen = true;
		gameOn = false;
	}
}

function playerLose() {
	displayGameOverScreen = true;
	gameOn = false;
	}

// =========================================================================
//Common Graphics Functions
function colorRect(topLeftX, topLeftY, boxWidth, boxHeight, fillColor) {
	ctx.fillStyle = fillColor;
	ctx.fillRect(topLeftX, topLeftY, boxWidth, boxHeight);
}

function colorCircle(centerX, centerY, radius, fillColor) {
    ctx.fillStyle = fillColor;
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, Math.PI*2, true);
    ctx.fill();
}

function colorText(text, posX, posY, font, color) {
	ctx.fillStyle = color;
	ctx.font = font;
	ctx.fillText (text, posX, posY);
}

</script>
</html>